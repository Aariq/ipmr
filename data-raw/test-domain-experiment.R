# domain testing

# test add_kernel

state_list <- list(c('dbh'))

x <- init_ipm('simple_di_det') %>%
  add_kernel("P1",
             formula = t(s * t(g)),
             family = "CC",
             s = 1/(1 + exp(-(s_int + s_slope * dbh_1))),
             g = dnorm(dbh_2, mu_g, sd_g),
             mu_g = g_int + g_slope * dbh_1,
             data_list = list(s_int = 2.2,
                              s_slope = 0.25,
                              g_int = 0.2,
                              g_slope = 1.02,
                              sd_g = 0.7),
             state_list = state_list,
             int_rule = 'midpoint',
             dom_start = 'ht',
             dom_end = 'dbh',
             evict = TRUE,
             evict_type = 'truncated_distributions') %>%
  add_kernel("P2",
             formula = t(s * t(g)),
             family = "CC",
             s = 1/(1 + exp(-(s_int + s_slope * dbh_1))),
             g = dnorm(dbh_2, mu_g, sd_g),
             mu_g = g_int + g_slope * dbh_1,
             data_list = list(s_int = 2.2,
                              s_slope = 0.25,
                              g_int = 0.2,
                              g_slope = 1.02,
                              sd_g = 0.7),
             state_list = state_list,
             int_rule = 'midpoint',
             dom_start = 'dbh',
             dom_end = 'dbh',
             evict = TRUE,
             evict_type = 'truncated_distributions') %>%
  add_kernel('F',
             formula = f_r * f_s * f_d,
             family = 'CC',
             f_r = 1/(1 + exp(-(f_r_int + f_r_slope * dbh_1))),
             f_s = exp(f_s_int + f_s_slope * dhb_1),
             f_d = dnorm(dbh_2, mu_fd, sd_fd),
             data_list = list(f_r_int = 0.2,
                              f_r_slope = 0.015,
                              f_s_int = 1.3,
                              f_s_slope = 0.075,
                              mu_fd = 0.5,
                              sd_fd = 0.2),
             state_list = state_list,
             int_rule = 'midpoint',
             dom_start = 'dbh',
             dom_end = 'ht',
             evict = TRUE,
             evict_type = 'truncated_distributions') %>%
  # add_kernel('K',
  #            formula = P + F,
  #            family = 'IPM',
  #            data_list = list(),
  #            state_list = state_list,
  #            int_rule = 'midpoint',
  #            dom_start = 'dbh',
  #            dom_end = 'dbh',
  #            evict = TRUE,
  #            evict_type = 'truncated_distributions') %>%
  define_domains(dbh = c(0, 50, 100),
                 ht = c(0,20, 50))# %>%
  # make_ipm()


# domain testing

# test add_kernel

state_list <- list(c('dbh'))

x <- init_ipm('simple_di_det') %>%
  add_kernel("P1",
             formula = t(s * t(g)),
             family = "CC",
             s = 1/(1 + exp(-(s_int + s_slope * dbh_1))),
             g = dnorm(dbh_2, mu_g, sd_g),
             mu_g = g_int + g_slope * dbh_1,
             data_list = list(s_int = 2.2,
                              s_slope = 0.25,
                              g_int = 0.2,
                              g_slope = 1.02,
                              sd_g = 0.7),
             state_list = state_list,
             int_rule = 'midpoint',
             dom_start = 'ht',
             dom_end = 'dbh',
             evict = TRUE,
             evict_type = 'truncated_distributions') %>%
  add_kernel("P2",
             formula = t(s * t(g)),
             family = "CC",
             s = 1/(1 + exp(-(s_int + s_slope * dbh_1))),
             g = dnorm(dbh_2, mu_g, sd_g),
             mu_g = g_int + g_slope * dbh_1,
             data_list = list(s_int = 2.2,
                              s_slope = 0.25,
                              g_int = 0.2,
                              g_slope = 1.02,
                              sd_g = 0.7),
             state_list = state_list,
             int_rule = 'midpoint',
             dom_start = 'dbh',
             dom_end = 'dbh',
             evict = TRUE,
             evict_type = 'truncated_distributions') %>%
  add_kernel('F',
             formula = f_r * f_s * f_d,
             family = 'CC',
             f_r = 1/(1 + exp(-(f_r_int + f_r_slope * dbh_1))),
             f_s = exp(f_s_int + f_s_slope * dhb_1),
             f_d = dnorm(dbh_2, mu_fd, sd_fd),
             data_list = list(f_r_int = 0.2,
                              f_r_slope = 0.015,
                              f_s_int = 1.3,
                              f_s_slope = 0.075,
                              mu_fd = 0.5,
                              sd_fd = 0.2),
             state_list = state_list,
             int_rule = 'midpoint',
             dom_start = 'dbh',
             dom_end = 'ht',
             evict = TRUE,
             evict_type = 'truncated_distributions') %>%
  add_kernel('SB',
             formula = sb_1 * sb_2,
             family = 'Dc',
             data_list = list(),
             state_list = state_list,
             int_rule = 'midpoint',
             dom_start = NA,
             dom_end =  'ht',
             evict = TRUE,
             evict_type = 'truncated_distributions') %>%
  define_domains(dbh = c(0, 50, 100),
                 ht = c(0,20, 50))
