<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>General IPMs • ipmr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="General IPMs">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipmr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/general-ipms.html">General IPMs</a>
    </li>
    <li>
      <a href="../articles/hierarchical-notation.html">Hierarchical Notation</a>
    </li>
    <li>
      <a href="../articles/ipmr-introduction.html">Introduction to ipmr</a>
    </li>
    <li>
      <a href="../articles/proto-ipms.html">proto_ipm data structure</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>General IPMs</h1>
                        <h4 class="author">Sam Levin</h4>
            
            <h4 class="date">2020-01-15</h4>
      
      
      <div class="hidden name"><code>general-ipms.Rmd</code></div>

    </div>

    
    
<div id="simple-ipms-vs-general-ipms" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-ipms-vs-general-ipms" class="anchor"></a>Simple IPMs vs General IPMs</h2>
<p>General IPMs are distinguished from simple ones in that they incorporate multiple state variables and/or include transitions between continuous and discrete states. A more specific defintion is provided in Ellner, Childs &amp; Rees, Chapter 6 (2016).</p>
<p><code>ipmr</code> handles general IPMs fairly differently from <code>IPMpack</code> in that it requires the population state to be defined initially and will compute all quantities via iteration. This is opposed to the “mega-matrix” construction that goes on under the hood in <code>IPMpack</code>, and means that eigenvalue based approaches for things like per-capita growth rates and stable stage distributions aren’t available. Fortunately, it also enables a more generalized approach to implementing complicated models, and so it is preferred because of that. Of course, one can always extract the individual sub-kernels from the final model object and build their own mega-matrices if a certain technique requires it. An example of how to do that is shown at the end of this vignette.</p>
</div>
<div id="a-general-density-independent-deterministic-ipm" class="section level2">
<h2 class="hasAnchor">
<a href="#a-general-density-independent-deterministic-ipm" class="anchor"></a>A general, density independent, deterministic IPM</h2>
<p>We’ll start with the least complicated of the general IPMs and build progressively from there. If you’ve already covered the <a href="https://levisc8.github.io/ipmr/articles/ipmr-introduction.html">Intro to ipmr</a>, then most of this will look pretty familiar. There are three new bits:</p>
<ol style="list-style-type: decimal">
<li><p>We are required to <code><a href="../reference/define_star.html">define_pop_state()</a></code> before calling <code><a href="../reference/make_ipm.html">make_ipm()</a></code>.</p></li>
<li><p>Each kernel that has an integration requires that <code>d_statevariable</code> get appended to the kernel <code>formula</code>. This is equivalent to the “dz” in <span class="math inline">\(\int_L^U K(z',z) n(z,t) \mathrm{dz}\)</span> <code>ipmr</code> automatically generates this variable internally, so there is no need to define it in the <code>data_list</code>. We skipped this step in the simple IPMs because it is easy to figure out what to append when there is only one continuous state variable and no discrete states. It is decidedly less easy to determine that for general IPMs where there may be many continuous and/or discrete states.</p></li>
<li><p>We don’t necessarily define a formula for <span class="math inline">\(K(ht',ht)\)</span> as we did in the simple IPMs. This is due to the point above about using iteration based methods for computing. Instead, we define how the kernels manipulate different population states at time <span class="math inline">\(t\)</span> to produce new states at time <span class="math inline">\(t+1\)</span>.</p></li>
</ol>
<p>This example will use a single discrete stage (seed bank, abbreviated <code>b</code>) and a single continuous state (height, abbreviated <code>ht</code>). Reproduction is time-lagged so all seeds must enter the seed bank (so <code>stay_discrete</code> = 0). They can either germinate in the next year, or they can die. Thus, the full model takes the following form:</p>
<ol style="list-style-type: decimal">
<li><p><span class="math inline">\(n(ht', t + 1) = \int_L^U P(ht', ht) n(ht,t)d\mathrm{ht} + b(t) * \int_L^U leave\_discrete(ht') \mathrm{dht'}\)</span></p></li>
<li><p><span class="math inline">\(b(t + 1) = go\_discrete(z) + stay\_discrete\)</span></p></li>
</ol>
<p>Below is the code to implement this model.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ipmr)</a></code></pre></div>
<pre><code>## Welcome to ipmr! browseVignettes('ipmr') to get started.</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Set up the initial population conditions and parameters</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">2312</span>)</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5">init_pop_vec   &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">500</span>)</a>
<a class="sourceLine" id="cb3-6" title="6">init_seed_bank &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8">data_list &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="dt">g_int     =</span> <span class="fl">5.781</span>,</a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="dt">g_slope   =</span> <span class="fl">0.988</span>,</a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="dt">g_sd      =</span> <span class="fl">20.55699</span>,</a>
<a class="sourceLine" id="cb3-12" title="12">  <span class="dt">s_int     =</span> <span class="fl">-0.352</span>,</a>
<a class="sourceLine" id="cb3-13" title="13">  <span class="dt">s_slope   =</span> <span class="fl">0.122</span>,</a>
<a class="sourceLine" id="cb3-14" title="14">  <span class="dt">s_slope_2 =</span> <span class="fl">-0.000213</span>,</a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="dt">f_r_int   =</span> <span class="fl">-11.46</span>,</a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="dt">f_r_slope =</span> <span class="fl">0.0835</span>,</a>
<a class="sourceLine" id="cb3-17" title="17">  <span class="dt">f_s_int   =</span> <span class="fl">2.6204</span>,</a>
<a class="sourceLine" id="cb3-18" title="18">  <span class="dt">f_s_slope =</span> <span class="fl">0.01256</span>,</a>
<a class="sourceLine" id="cb3-19" title="19">  <span class="dt">f_d_mu    =</span> <span class="fl">5.6655</span>,</a>
<a class="sourceLine" id="cb3-20" title="20">  <span class="dt">f_d_sd    =</span> <span class="fl">2.0734</span>,</a>
<a class="sourceLine" id="cb3-21" title="21">  <span class="dt">e_p       =</span> <span class="fl">0.15</span>,</a>
<a class="sourceLine" id="cb3-22" title="22">  <span class="dt">g_i       =</span> <span class="fl">0.5067</span></a>
<a class="sourceLine" id="cb3-23" title="23">)</a>
<a class="sourceLine" id="cb3-24" title="24"></a>
<a class="sourceLine" id="cb3-25" title="25"><span class="co"># The lower and upper bounds for the continuous state variable and the number</span></a>
<a class="sourceLine" id="cb3-26" title="26"><span class="co"># of meshpoints for the midpoint rule integration.</span></a>
<a class="sourceLine" id="cb3-27" title="27"></a>
<a class="sourceLine" id="cb3-28" title="28">L &lt;-<span class="st"> </span><span class="fl">1.02</span></a>
<a class="sourceLine" id="cb3-29" title="29">U &lt;-<span class="st"> </span><span class="dv">624</span></a>
<a class="sourceLine" id="cb3-30" title="30">n &lt;-<span class="st"> </span><span class="dv">500</span></a>
<a class="sourceLine" id="cb3-31" title="31"></a>
<a class="sourceLine" id="cb3-32" title="32"><span class="co"># Initialize the state list and add some helper functions. The survival function</span></a>
<a class="sourceLine" id="cb3-33" title="33"><span class="co"># in this model is a quadratic function.</span></a>
<a class="sourceLine" id="cb3-34" title="34"></a>
<a class="sourceLine" id="cb3-35" title="35">states &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'ht'</span>, <span class="st">'sb'</span>))</a>
<a class="sourceLine" id="cb3-36" title="36"></a>
<a class="sourceLine" id="cb3-37" title="37">inv_logit &lt;-<span class="st"> </span><span class="cf">function</span>(int, slope, sv) {</a>
<a class="sourceLine" id="cb3-38" title="38">  <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span>(int <span class="op">+</span><span class="st"> </span>slope <span class="op">*</span><span class="st"> </span>sv)))</a>
<a class="sourceLine" id="cb3-39" title="39">}</a>
<a class="sourceLine" id="cb3-40" title="40"></a>
<a class="sourceLine" id="cb3-41" title="41">inv_logit_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="cf">function</span>(int, slope, slope_<span class="dv">2</span>, sv) {</a>
<a class="sourceLine" id="cb3-42" title="42">  <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span>(int <span class="op">+</span><span class="st"> </span>slope <span class="op">*</span><span class="st"> </span>sv <span class="op">+</span><span class="st"> </span>slope_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sv <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb3-43" title="43">}</a>
<a class="sourceLine" id="cb3-44" title="44"></a>
<a class="sourceLine" id="cb3-45" title="45">general_ipm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/init_ipm.html">init_ipm</a></span>(<span class="st">"general_di_det"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-46" title="46"><span class="st">  </span><span class="kw"><a href="../reference/kernel-definitions.html">define_kernel</a></span>(</a>
<a class="sourceLine" id="cb3-47" title="47">    <span class="dt">name          =</span> <span class="st">"P"</span>,</a>
<a class="sourceLine" id="cb3-48" title="48">    </a>
<a class="sourceLine" id="cb3-49" title="49">    <span class="co"># We add d_ht to formula to make sure integration is handled correctly.</span></a>
<a class="sourceLine" id="cb3-50" title="50">    <span class="co"># This variable is generated internally by make_ipm(), so we don't need</span></a>
<a class="sourceLine" id="cb3-51" title="51">    <span class="co"># to do anything else.</span></a>
<a class="sourceLine" id="cb3-52" title="52">    </a>
<a class="sourceLine" id="cb3-53" title="53">    <span class="dt">formula       =</span> <span class="kw"><a href="../reference/fun-mult-helpers.html">s_g_mult</a></span>(s, g) <span class="op">*</span><span class="st"> </span>d_ht,</a>
<a class="sourceLine" id="cb3-54" title="54">    </a>
<a class="sourceLine" id="cb3-55" title="55">    <span class="co"># The family argument tells ipmr what kind of transition this kernel describes.</span></a>
<a class="sourceLine" id="cb3-56" title="56">    <span class="co"># it can be "CC" for continuous -&gt; continuous, "DC" for discrete -&gt; continuous</span></a>
<a class="sourceLine" id="cb3-57" title="57">    <span class="co"># "CD" for continuous -&gt; discrete, or "DD" for discrete -&gt; discrete.</span></a>
<a class="sourceLine" id="cb3-58" title="58">    </a>
<a class="sourceLine" id="cb3-59" title="59">    <span class="dt">family        =</span> <span class="st">"CC"</span>,</a>
<a class="sourceLine" id="cb3-60" title="60">    </a>
<a class="sourceLine" id="cb3-61" title="61">    <span class="co"># The rest of the arguments are exactly the same as in the simple models</span></a>
<a class="sourceLine" id="cb3-62" title="62">    </a>
<a class="sourceLine" id="cb3-63" title="63">    <span class="dt">g             =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(ht_<span class="dv">2</span>, g_mu, g_sd),</a>
<a class="sourceLine" id="cb3-64" title="64">    <span class="dt">g_mu          =</span> g_int <span class="op">+</span><span class="st"> </span>g_slope <span class="op">*</span><span class="st"> </span>ht_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-65" title="65">    <span class="dt">s             =</span> <span class="kw">inv_logit_2</span>(s_int, s_slope, s_slope_<span class="dv">2</span>, ht_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb3-66" title="66">    <span class="dt">data_list     =</span> data_list,</a>
<a class="sourceLine" id="cb3-67" title="67">    <span class="dt">states        =</span> states,</a>
<a class="sourceLine" id="cb3-68" title="68">    <span class="dt">has_hier_effs =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb3-69" title="69">    <span class="dt">evict         =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-70" title="70">    <span class="dt">evict_fun     =</span> <span class="kw"><a href="../reference/eviction.html">truncated_distributions</a></span>(<span class="st">'norm'</span>,</a>
<a class="sourceLine" id="cb3-71" title="71">                                            <span class="st">'g'</span>)</a>
<a class="sourceLine" id="cb3-72" title="72">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-73" title="73"><span class="st">  </span><span class="kw"><a href="../reference/kernel-definitions.html">define_kernel</a></span>(</a>
<a class="sourceLine" id="cb3-74" title="74">    <span class="dt">name          =</span> <span class="st">"go_discrete"</span>,</a>
<a class="sourceLine" id="cb3-75" title="75">    <span class="dt">formula       =</span> f_r <span class="op">*</span><span class="st"> </span>f_s <span class="op">*</span><span class="st"> </span>g_i,</a>
<a class="sourceLine" id="cb3-76" title="76">    <span class="dt">family        =</span> <span class="st">'CD'</span>,</a>
<a class="sourceLine" id="cb3-77" title="77">    <span class="dt">f_r           =</span> <span class="kw">inv_logit</span>(f_r_int, f_r_slope, ht_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb3-78" title="78">    <span class="dt">f_s           =</span> <span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(f_s_int <span class="op">+</span><span class="st"> </span>f_s_slope <span class="op">*</span><span class="st"> </span>ht_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb3-79" title="79">    <span class="dt">data_list     =</span> data_list,</a>
<a class="sourceLine" id="cb3-80" title="80">    <span class="dt">states        =</span> states,</a>
<a class="sourceLine" id="cb3-81" title="81">    <span class="dt">has_hier_effs =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb3-82" title="82">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-83" title="83"><span class="st">  </span><span class="kw"><a href="../reference/kernel-definitions.html">define_kernel</a></span>(</a>
<a class="sourceLine" id="cb3-84" title="84">    <span class="dt">name    =</span> <span class="st">'stay_discrete'</span>,</a>
<a class="sourceLine" id="cb3-85" title="85">    </a>
<a class="sourceLine" id="cb3-86" title="86">    <span class="co"># In this case, seeds in the seed bank either germinate or die, but they </span></a>
<a class="sourceLine" id="cb3-87" title="87">    <span class="co"># do not remain for multipe time steps. This can be adjusted as needed.</span></a>
<a class="sourceLine" id="cb3-88" title="88">    </a>
<a class="sourceLine" id="cb3-89" title="89">    <span class="dt">formula =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-90" title="90">    <span class="dt">family  =</span> <span class="st">"DD"</span>,</a>
<a class="sourceLine" id="cb3-91" title="91">    <span class="dt">states  =</span> states,</a>
<a class="sourceLine" id="cb3-92" title="92">    <span class="dt">evict =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb3-93" title="93">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-94" title="94"><span class="st">  </span><span class="kw"><a href="../reference/kernel-definitions.html">define_kernel</a></span>(</a>
<a class="sourceLine" id="cb3-95" title="95">    <span class="dt">name          =</span> <span class="st">'leave_discrete'</span>,</a>
<a class="sourceLine" id="cb3-96" title="96">    <span class="dt">formula       =</span> e_p <span class="op">*</span><span class="st"> </span>f_d <span class="op">*</span><span class="st"> </span>d_ht,</a>
<a class="sourceLine" id="cb3-97" title="97">    <span class="dt">f_d           =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(ht_<span class="dv">2</span>, f_d_mu, f_d_sd),</a>
<a class="sourceLine" id="cb3-98" title="98">    <span class="dt">family        =</span> <span class="st">'DC'</span>,</a>
<a class="sourceLine" id="cb3-99" title="99">    <span class="dt">data_list     =</span> data_list,</a>
<a class="sourceLine" id="cb3-100" title="100">    <span class="dt">states        =</span> states,</a>
<a class="sourceLine" id="cb3-101" title="101">    <span class="dt">has_hier_effs =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb3-102" title="102">    <span class="dt">evict         =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-103" title="103">    <span class="dt">evict_fun     =</span> <span class="kw"><a href="../reference/eviction.html">truncated_distributions</a></span>(<span class="st">'norm'</span>,</a>
<a class="sourceLine" id="cb3-104" title="104">                                            <span class="st">'f_d'</span>)</a>
<a class="sourceLine" id="cb3-105" title="105">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-106" title="106"><span class="st">  </span><span class="kw"><a href="../reference/kernel-definitions.html">define_k</a></span>(</a>
<a class="sourceLine" id="cb3-107" title="107">    <span class="dt">name          =</span> <span class="st">"K"</span>,</a>
<a class="sourceLine" id="cb3-108" title="108">    <span class="dt">family        =</span> <span class="st">"IPM"</span>,</a>
<a class="sourceLine" id="cb3-109" title="109">    </a>
<a class="sourceLine" id="cb3-110" title="110">    <span class="co"># We don't really define a mega-K as we do with simple models, but rather</span></a>
<a class="sourceLine" id="cb3-111" title="111">    <span class="co"># describe how the state at t is modified by the sub-kernels to produce</span></a>
<a class="sourceLine" id="cb3-112" title="112">    <span class="co"># the state at t + 1. </span></a>
<a class="sourceLine" id="cb3-113" title="113">    </a>
<a class="sourceLine" id="cb3-114" title="114">    <span class="dt">n_b_t_1       =</span> stay_discrete <span class="op">%*%</span><span class="st"> </span>n_b_t  <span class="op">+</span><span class="st"> </span>go_discrete <span class="op">%*%</span><span class="st"> </span>n_ht_t,</a>
<a class="sourceLine" id="cb3-115" title="115">    <span class="dt">n_ht_t_1      =</span> leave_discrete <span class="op">%*%</span><span class="st"> </span>n_b_t <span class="op">+</span><span class="st"> </span>P <span class="op">%*%</span><span class="st"> </span>n_ht_t,</a>
<a class="sourceLine" id="cb3-116" title="116">    <span class="dt">data_list     =</span> data_list,</a>
<a class="sourceLine" id="cb3-117" title="117">    <span class="dt">states        =</span> states,</a>
<a class="sourceLine" id="cb3-118" title="118">    <span class="dt">has_hier_effs =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb3-119" title="119">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-120" title="120"><span class="st">  </span><span class="kw"><a href="../reference/define_star.html">define_impl</a></span>(</a>
<a class="sourceLine" id="cb3-121" title="121">    <span class="kw"><a href="../reference/define_star.html">make_impl_args_list</a></span>(</a>
<a class="sourceLine" id="cb3-122" title="122">      <span class="dt">kernel_names =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"P"</span>, <span class="st">"go_discrete"</span>, <span class="st">"stay_discrete"</span>, <span class="st">"leave_discrete"</span>, <span class="st">"K"</span>),</a>
<a class="sourceLine" id="cb3-123" title="123">      <span class="dt">int_rule     =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"midpoint"</span>, <span class="dv">5</span>)),</a>
<a class="sourceLine" id="cb3-124" title="124">      <span class="dt">dom_start    =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'ht'</span>, <span class="st">"ht"</span>, <span class="ot">NA_character_</span>, <span class="ot">NA_character_</span>, <span class="st">"ht"</span>),</a>
<a class="sourceLine" id="cb3-125" title="125">      <span class="dt">dom_end      =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'ht'</span>, <span class="ot">NA_character_</span>, <span class="ot">NA_character_</span>, <span class="st">'ht'</span>, <span class="st">'ht'</span>)</a>
<a class="sourceLine" id="cb3-126" title="126">    )</a>
<a class="sourceLine" id="cb3-127" title="127">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-128" title="128"><span class="st">  </span><span class="kw"><a href="../reference/define_star.html">define_domains</a></span>(</a>
<a class="sourceLine" id="cb3-129" title="129">    <span class="dt">ht =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(L, U, n)</a>
<a class="sourceLine" id="cb3-130" title="130">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-131" title="131"><span class="st">  </span><span class="kw"><a href="../reference/define_star.html">define_pop_state</a></span>(</a>
<a class="sourceLine" id="cb3-132" title="132">    <span class="dt">pop_vectors =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb3-133" title="133">      <span class="dt">n_ht =</span> init_pop_vec,</a>
<a class="sourceLine" id="cb3-134" title="134">      <span class="dt">n_b  =</span> init_seed_bank</a>
<a class="sourceLine" id="cb3-135" title="135">    )</a>
<a class="sourceLine" id="cb3-136" title="136">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-137" title="137"><span class="st">  </span><span class="kw"><a href="../reference/make_ipm.html">make_ipm</a></span>(<span class="dt">iterations =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb3-138" title="138">           <span class="dt">usr_funs =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">inv_logit   =</span> inv_logit,</a>
<a class="sourceLine" id="cb3-139" title="139">                           <span class="dt">inv_logit_2 =</span> inv_logit_<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb3-140" title="140"></a>
<a class="sourceLine" id="cb3-141" title="141"></a>
<a class="sourceLine" id="cb3-142" title="142"><span class="co"># lambda is a generic function to compute per-capita growth rates. It has a number</span></a>
<a class="sourceLine" id="cb3-143" title="143"><span class="co"># of different options which are explored in the "Generics" vignette (still to be</span></a>
<a class="sourceLine" id="cb3-144" title="144"><span class="co"># written!).</span></a>
<a class="sourceLine" id="cb3-145" title="145"></a>
<a class="sourceLine" id="cb3-146" title="146"><span class="kw"><a href="../reference/lambda.html">lambda</a></span>(general_ipm)[<span class="dv">100</span>]</a></code></pre></div>
<pre><code>## [1] 1.222062</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># If we are worried about whether or not the model converged to stable</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co"># dynamics, we can call lambda with type_lambda = 'all' and examine the final</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co"># iterations to make sure it has. The snippet below prints lambda from the </span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co"># the last 10 iterations of the model</span></a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6">lambdas &lt;-<span class="st"> </span><span class="kw"><a href="../reference/lambda.html">lambda</a></span>(general_ipm, <span class="dt">type_lambda =</span> <span class="st">'all'</span>)</a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8">lambda_ind &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>((<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(lambdas) <span class="op">-</span><span class="st"> </span><span class="dv">10</span>), <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(lambdas), <span class="dt">by =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-9" title="9"></a>
<a class="sourceLine" id="cb5-10" title="10">last_<span class="dv">10</span> &lt;-<span class="st"> </span>lambdas[lambda_ind]</a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co"># If it's converged, then this should return TRUE</span></a>
<a class="sourceLine" id="cb5-13" title="13"></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="kw"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span>(</a>
<a class="sourceLine" id="cb5-15" title="15">  <span class="kw"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(</a>
<a class="sourceLine" id="cb5-16" title="16">    <span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span>(last_<span class="dv">10</span>)[<span class="dv">1</span>], <span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span>(last_<span class="dv">10</span>)[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb5-17" title="17">  )</a>
<a class="sourceLine" id="cb5-18" title="18">)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="general-hierarchical-models" class="section level2">
<h2 class="hasAnchor">
<a href="#general-hierarchical-models" class="anchor"></a>General hierarchical models</h2>
</div>
<div id="general-models-with-continuously-varying-environments" class="section level2">
<h2 class="hasAnchor">
<a href="#general-models-with-continuously-varying-environments" class="anchor"></a>General models with continuously varying environments</h2>
</div>
<div id="code-to-construct-your-own-mega-matrices" class="section level2">
<h2 class="hasAnchor">
<a href="#code-to-construct-your-own-mega-matrices" class="anchor"></a>Code to construct your own mega-matrices</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simple-ipms-vs-general-ipms">Simple IPMs vs General IPMs</a></li>
      <li><a href="#a-general-density-independent-deterministic-ipm">A general, density independent, deterministic IPM</a></li>
      <li><a href="#general-hierarchical-models">General hierarchical models</a></li>
      <li><a href="#general-models-with-continuously-varying-environments">General models with continuously varying environments</a></li>
      <li><a href="#code-to-construct-your-own-mega-matrices">Code to construct your own mega-matrices</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/levisc8">Sam Levin</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
