<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Functions to initialize and define IPM kernels — define_kernel • ipmr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Functions to initialize and define IPM kernels — define_kernel" />
<meta property="og:description" content="Adds a new kernel to the proto_ipm structure." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipmr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="divider"></li>
    <li class="dropdown-header">Introduction to ipmr</li>
    <li>
      <a href="../articles/ipmr-introduction.html">Introduction to ipmr</a>
    </li>
    <li>
      <a href="../articles/general-ipms.html">General IPMs</a>
    </li>
    <li>
      <a href="../articles/hierarchical-notation.html">Hierarchical Notation</a>
    </li>
    <li>
      <a href="../articles/age_x_size.html">Age-Size IPMs</a>
    </li>
    <li>
      <a href="../articles/density-dependence.html">Density Dependent IPMs</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Generic Functions</li>
    <li>
      <a href="../articles/generic-funs.html">List of Generic and Helper Functions in ipmr</a>
    </li>
    <li>
      <a href="../articles/generic-progress.html">Generic Progress</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">proto_ipm Overview</li>
    <li>
      <a href="../articles/proto-ipms.html">proto_ipm Data Structure</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Functions to initialize and define IPM kernels</h1>
    
    <div class="hidden name"><code>kernel-definitions.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Adds a new kernel to the <code>proto_ipm</code> structure.</p>
    </div>

    <pre class="usage"><span class='fu'>define_kernel</span><span class='op'>(</span>
  <span class='va'>proto_ipm</span>,
  <span class='va'>name</span>,
  <span class='va'>formula</span>,
  <span class='va'>family</span>,
  <span class='va'>...</span>,
  data_list <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  <span class='va'>states</span>,
  has_hier_effs <span class='op'>=</span> <span class='cn'>FALSE</span>,
  levels_hier_effs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  levels_ages <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  evict_cor <span class='op'>=</span> <span class='cn'>FALSE</span>,
  evict_fun <span class='op'>=</span> <span class='cn'>NULL</span>,
  integrate <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>proto_ipm</th>
      <td><p>The name of the model.</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>The name of the new kernel.</p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>A bare expression specifying the form of the kernel. See Details.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>The type of kernel. Options are <code>"CC"</code> for continuous to continuous
transitions, <code>"DC"</code> for discrete to continuous (e.g. emergence from a seedbank),
<code>"CD"</code> for continuous to discrete (e.g. entering a seedbank), and <code>"DD"</code> for
discrete to discrete (e.g. stasis in a seedbank).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>For <code>define_kernel</code>, a set of named expressions that correspond
to vital rates in <code>formula</code>. Suffix expansion of hierarchical models is supported.</p></td>
    </tr>
    <tr>
      <th>data_list</th>
      <td><p>A list of named values that correspond to constants in the formula.
You do not need to specify vectors corresponding to the domains here.</p></td>
    </tr>
    <tr>
      <th>states</th>
      <td><p>A list with character vector containing the names of each state
variable used in the kernel.</p></td>
    </tr>
    <tr>
      <th>has_hier_effs</th>
      <td><p>A logical indicating whether or not the kernel and/or its
underlying vital rates are structured with hierarchical effects. If so and you
specify either the functional forms or the exact parameter values you want to use,
the kernels will be automatically split according to the notation in the vital
rates and kernel formulae and multiple kernels will be built. See the vignette
on the syntax for this feature for more details (<code><a href='https://rdrr.io/r/utils/vignette.html'>vignettes(
'hierarchical-notation', package = 'ipmr')</a></code>).</p></td>
    </tr>
    <tr>
      <th>levels_hier_effs</th>
      <td><p>A named list with vectors corresponding to the various levels
the hierarchical variable can take. The names should match the suffixes used
in the vital rate expressions.</p></td>
    </tr>
    <tr>
      <th>levels_ages</th>
      <td><p>A list with possibly 2 entries: 1. <code>"age"</code>: the range
of possible ages in the model and, optionally, 2. <code>"max_age"</code>: the maximum
age individuals in the model can attain.</p></td>
    </tr>
    <tr>
      <th>evict_cor</th>
      <td><p>A logical indicating whether an eviction correction should be applied
to the kernel.</p></td>
    </tr>
    <tr>
      <th>evict_fun</th>
      <td><p>If <code>evict_cor== TRUE</code>, then a function that corrects for it.
Currently, the only implemented function is <code>truncated_distributions</code>.
This works by modifying the functional form of the vital rate expressions
<code>...</code>, and so supplying your own function in this slot will be difficult.
You can also either specify a <code>usr_funs</code> function that performs the correction
during the implementation of the model itself, or incorporate the correction
into individual vital rate expressions. In either of those cases,
set <code>evict_cor</code> to <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>integrate</th>
      <td><p>For <code>simple_*</code> models, this controls whether a <code>"d_z"</code>
is automatically appended to the <code>formula</code> argument. When <code>TRUE</code>,
this automatically creates a <code>formula * d_z</code>. There may be some cases where
this behavior is not desirable. Set this to <code>FALSE</code> and specify the correct
math if that happens. The default is <code>TRUE</code>. This argument is ignored for
all <code>general_*</code> models.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>All functions described here return a  <code>proto_ipm</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Different classes of IPMs may have many or only a few kernels. Each
one requires its own call to this function, though there are some exceptions,
namely for kernels derived from hierarchical models (e.g. vital rate models
fit across plots and years). <code>remove_k</code> is a helper for re-building models
but with a different <code>K</code> kernel.</p>
<p>Internally, <code>ipmr</code> generates the <code>levels_hier_effs</code> using <code>expand.grid</code>.
This  means that every combination of the values in <code>levels_hier_effs</code>
must exist in the <code>data_list</code>, or the model will fail with an error along
the lines of <code>Error in eval_tidy: object 'x_yz' not found</code>. In order to
exclude levels that do not exist in your data, you can add a vector to the list
in <code>levels_hier_effs</code> called <code>"drop_levels"</code>. This should contain the
values you wish to exclude as a character vector. For example, if data are
collected for <code>sites = c("a", "b", "c")</code>, and <code>years = c(2005:2008)</code>,
but there is no data from site <code>"a"</code> in <code>2007</code>, we can use
<code>levels_hier_effs = list(site = c("a", "b", "c"), year = c(2005:2008),
drop_levels = c("a_2007"))</code>.</p>

<p><code>define_kernel</code> generates most of the information needed to create an IPM
kernel. There are a few requirements - <code>name</code>, <code>family</code>,
<code>formula</code>, and <code>states</code> must not be empty. The <code>formula</code> should be an expression
for how vital rates produce a kernel (e.g. <code>formula = S * G</code>). The
<code>...</code> should be a set of named expressions that correspond to vital rate
expressions (e.g. <code>G = dnorm(size_2, mean_size, sd_size)</code>). See the vignettes
for more information on how to get started.</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://github.com/levisc8'>Sam Levin</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


